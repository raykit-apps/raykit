# Extension Architecture Design

## Flow Diagram

```mermaid
flowchart TB
    subgraph "ä¸»è¿›ç¨‹ Main Process"
        MP[MainProcess
        <br />ä¸»è¿›ç¨‹æ§åˆ¶å™¨
        <br />ğŸ“‹ ä½œç”¨ï¼šç³»ç»Ÿåˆå§‹åŒ–ä¸åè°ƒ]

        WS[WindowStore
        <br />çª—å£å­˜å‚¨ç®¡ç†å™¨
        <br />ğŸ“‹ ä½œç”¨ï¼šç®¡ç†åº”ç”¨çª—å£ç”Ÿå‘½å‘¨æœŸ]

        EM[ExtensionManagement
        <br />æ‰©å±•ç®¡ç†ç³»ç»Ÿ
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•å®‰è£…/å¸è½½/æ›´æ–°/å¯ç”¨/ç¦ç”¨]

        EH[ExtensionHost
        <br />æ‰©å±•ä¸»æœºæœåŠ¡
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•è¿›ç¨‹ç®¡ç†ä¸é€šä¿¡]

        ER[ExtensionRegistry
        <br />æ‰©å±•æ³¨å†Œè¡¨
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•å‘ç°ä¸å…ƒæ•°æ®ç®¡ç†]

        IM[InstallationManager
        <br />å®‰è£…ç®¡ç†å™¨
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•ä¸‹è½½/è§£å‹/éªŒè¯]
    end

    subgraph "çª—å£å±‚ Window Layer"
        WSHELL[WindowShell
        <br />çª—å£å¤–å£³
        <br />ğŸ“‹ ä½œç”¨ï¼šElectronçª—å£å°è£…]

        WV[WebContentsView
        <br />Webå†…å®¹è§†å›¾
        <br />ğŸ“‹ ä½œç”¨ï¼šæ¸²æŸ“æ‰©å±•UIç•Œé¢]
    end

    subgraph "æ‰©å±•è¿›ç¨‹ Extension Process"
        EP[ExtensionProcess
        <br />æ‰©å±•è¿›ç¨‹
        <br />ğŸ“‹ ä½œç”¨ï¼šéš”ç¦»ç¯å¢ƒä¸­è¿è¡Œæ‰©å±•ä»£ç ]

        EXT[Extension
        <br />æ‰©å±•å®ä¾‹
        <br />ğŸ“‹ ä½œç”¨ï¼šå…·ä½“æ‰©å±•åŠŸèƒ½å®ç°]

        EMAN[ExtensionManifest
        <br />æ‰©å±•æ¸…å•
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•å…ƒæ•°æ®ä¸åŠŸèƒ½å®šä¹‰]
    end

    subgraph "æ•°æ®å±‚ Data Layer"
        CM[ContributesManifest
        <br />è´¡çŒ®æ¸…å•
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•åŠŸèƒ½è´¡çŒ®å®šä¹‰]

        EXTD[ExtensionData
        <br />æ‰©å±•æ•°æ®
        <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•è¿è¡Œæ—¶çŠ¶æ€ä¸é…ç½®]
    end

    %% ä¸»æµç¨‹
    MP -->|åˆå§‹åŒ–ç³»ç»Ÿ| WS
    MP -->|åˆå§‹åŒ–æ‰©å±•ç³»ç»Ÿ| EM
    MP -->|åˆ›å»ºæ‰©å±•ä¸»æœº| EH

    EM -->|ä½¿ç”¨| EH
    EM -->|ç®¡ç†| ER
    EM -->|è°ƒç”¨| IM

    EH -->|åˆ›å»ºè¿›ç¨‹| EP
    EH -->|ç®¡ç†å®ä¾‹| EXT
    EH -->|é€šä¿¡| EP

    WS -->|åˆ›å»ºçª—å£| WSHELL
    WSHELL -->|é™„åŠ è§†å›¾| WV

    ER -->|æ³¨å†Œæ‰©å±•| EXT
    ER -->|åŠ è½½æ¸…å•| EMAN

    EXT -->|è¯»å–é…ç½®| EMAN
    EXT -->|å®šä¹‰åŠŸèƒ½| CM
    EXT -->|å­˜å‚¨çŠ¶æ€| EXTD

    IM -->|ä¸‹è½½æ‰©å±•| EXT
    IM -->|éªŒè¯æ‰©å±•| EMAN

    %% ç”¨æˆ·äº¤äº’æµç¨‹
    U1([ç”¨æˆ·è¯·æ±‚å®‰è£…æ‰©å±•]) -->|è§¦å‘| EM
    U2([ç”¨æˆ·è¯·æ±‚å¸è½½æ‰©å±•]) -->|è§¦å‘| EM
    U3([ç”¨æˆ·å¯ç”¨/ç¦ç”¨æ‰©å±•]) -->|è§¦å‘| EM
    U4([ç”¨æˆ·æ‰“å¼€æ‰©å±•çª—å£]) -->|è§¦å‘| WS

    EM -->|å®‰è£…æˆåŠŸ| ER
    EM -->|å¸è½½æˆåŠŸ| ER
    EM -->|çŠ¶æ€å˜æ›´| EH

    EH -->|å¯åŠ¨è¿›ç¨‹| EP
    EH -->|ç»ˆæ­¢è¿›ç¨‹| EP

    WS -->|åˆ›å»ºæ‰©å±•UI| WSHELL
    WSHELL -->|åŠ è½½æ‰©å±•é¡µé¢| WV
```

```mermaid
flowchart TB
  subgraph "ç”¨æˆ·æ“ä½œ"
    U1([æœç´¢æ‰©å±•])
    U2([å®‰è£…æ‰©å±•])
    U3([å¸è½½æ‰©å±•])
    U4([ç¦ç”¨æ‰©å±•])
    U5([æ›´æ–°æ‰©å±•])
    U5([æ‰§è¡Œå‘½ä»¤])
  end

  subgraph "ä¸»è¿›ç¨‹ Main Process"
    MP[MainProcess <br /> ä¸»è¿›ç¨‹æ§åˆ¶å™¨<br /> ç³»ç»Ÿåˆå§‹åŒ–ä¸åè°ƒ]

    WS[WindowStore <br />çª—å£å­˜å‚¨ç®¡ç†å™¨ <br /> ç®¡ç†åº”ç”¨çª—å£ç”Ÿå‘½å‘¨æœŸ]

    EM[ExtensionManagement
    <br />æ‰©å±•ç®¡ç†ç³»ç»Ÿ
    <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•å®‰è£…/å¸è½½/æ›´æ–°/å¯ç”¨/ç¦ç”¨]

    EH[ExtensionHost
    <br />æ‰©å±•ä¸»æœºæœåŠ¡
    <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•è¿›ç¨‹ç®¡ç†ä¸é€šä¿¡]

    ER[ExtensionRegistry
    <br />æ‰©å±•æ³¨å†Œè¡¨
    <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•å‘ç°ä¸å…ƒæ•°æ®ç®¡ç†]

    IM[InstallationManager
    <br />å®‰è£…ç®¡ç†å™¨
    <br />ğŸ“‹ ä½œç”¨ï¼šæ‰©å±•ä¸‹è½½/è§£å‹/éªŒè¯]
  end
```
